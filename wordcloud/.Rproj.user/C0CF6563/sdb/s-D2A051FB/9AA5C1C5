{
    "collab_server" : "",
    "contents" : "# Scarlett\n# Dec 12, 2016\nsetwd(\"/Users/Scarlett/Desktop/Projects/twitter\")\nlibrary(ROAuth)\nlibrary(streamR)\nlibrary(tm)\nlibrary(SnowballC)\nlibrary(wordcloud)\nlibrary(cluster)\nlibrary(RColorBrewer)\nlibrary(plyr)\nlibrary(leaflet)\nlibrary(rgdal)\nsource(\"latlong2state.r\")\n\n\n# ================ ROAuth =========================\nlibrary(ROAuth)\nrequestURL <- \"https://api.twitter.com/oauth/request_token\"\naccessURL <- \"https://api.twitter.com/oauth/access_token\"\nauthURL <- \"https://api.twitter.com/oauth/authorize\"\nconsumerKey <- \"IqSkDmnKey0vVc7cVjKHT2n9s\"\nconsumerSecret <- \"23H1fGt0I6GUkZru4TSLGOS7PgS7PSlpiOhIlkbMCDFMNx9R9z\"\nmy_oauth <- OAuthFactory$new(consumerKey = consumerKey, consumerSecret = consumerSecret, \n                             requestURL = requestURL, accessURL = accessURL, authURL = authURL)\nmy_oauth$handshake(cainfo = system.file(\"CurlSSL\", \"cacert.pem\", package = \"RCurl\"))\nsave(my_oauth, file = \"my_oauth.Rdata\")\n\n\n# ================ stream =========================\nlibrary(streamR)\nload(\"my_oauth.Rdata\")\n# get tweets from trend \"StuffMyStockingWith\nfilterStream( file.name=\"wish.json\",\n              track = \"StuffMyStockingWith\", \n              locations = c(-125,25,-66,50),  \n              timeout = 600, oauth=my_oauth)\nwish.df <- parseTweets(\"wish.json\")\nsave(wish.df, file = \"wish.df.rds\")\n\n# ================ data cleaning =================\nwish.df.text <- wish.df$text\nclean <- function(x) {\n  x <- iconv(x, \"ASCII\", \"UTF-8\", sub=\"\")    # remove all emojis\n  x <- gsub(\"@\\\\w+ *\", \"\", x)\n  x <- gsub(\"#\\\\w+ *\", \"\", x)\n  x <- gsub(\"\\n\", \" \", x)\n  x <- gsub(\"[^a-zA-Z #]\",\"\",x)    # \"a-zA-Z #\" are the things we need, [^a-zA-Z #] are the things to get rid of\n  x <- gsub(\"https\\\\w+ *\", \"\", x)\n  x <- tolower(x)\n  return(x)\n}\ncleantext <- clean(wish.df.text)\n\n\n# ================ wordcloud ======================\nlibrary(tm)\nlibrary(SnowballC)\nlibrary(wordcloud)\nlibrary(cluster)\nlibrary(RColorBrewer)\nlibrary(plyr)\n\ncleantext <- clean(wish.df.text)\n\nwish.Corpus <- Corpus(VectorSource(cleantext))\nwish.Corpus <- tm_map(wish.Corpus, removeWords, stopwords('english'))\nwish.Corpus <- tm_map(wish.Corpus, removeWords, c('just', 'like', 'dont', 'get', 'one', 'amp', stopwords('english')))\n\nwordcloud(wish.Corpus, max.words = 100, random.order = FALSE, colors = brewer.pal(8, \"Dark2\"))\n\n\n# ====== state-based geo info (frequency) for keyword \"love\" =======\nsource(\"latlong2state.r\")\nlibrary(rgdal)\n\nload(\"wish.df.rds\")\nwish.df$text <- cleantext\n\npos <- grep(\"love\", wish.df$text)\nlove.df <- na.omit(wish.df[pos, c(1,15,37,38)])\n\nlove.loc <- (data.frame(love.df$place_lon, love.df$place_lat))\nstates <- latlong2state(love.loc)\n\nfreq.table <- as.data.frame(table(states))\n\ndns <- \"/Users/Scarlett/Desktop/Projects/twitter/USA_shapefile\"\nfn <- list.files(dns, pattern = \".shp\", full.names = FALSE)\nfn <- gsub(\".shp\", \"\", fn)\nshape <- readOGR(dns, fn[2])\n\nshape.state <- as.data.frame(tolower(shape$NAME_1))\nstate.freq <- merge(shape.state, freq.table, by.x = \"tolower(shape$NAME_1)\", by.y = \"states\", all = TRUE)\n\n\n# ================ leaflet: interactive map ======================\nlibrary(leaflet)\nlibrary(rgdal)\ndns <- \"/Users/Scarlett/Desktop/Projects/twitter/USA_shapefile\"\nfn <- list.files(dns, pattern = \".shp\", full.names = FALSE)\nfn <- gsub(\".shp\", \"\", fn)\nshape <- readOGR(dns, fn[2])\nshape$Freq <- state.freq$Freq\n\ni_popup <- paste0(\"<strong>State: </strong>\", \n                  shape$NAME_1, \n                  \"<br>\",\n                  \"<strong>Love Score: </strong>\", \n                  shape$Freq)\n\npal <- colorQuantile(\"PuRd\", NULL, n = 5)    \n\nleaflet(shape) %>% addTiles() %>%\n  setView(-95, 37, zoom = 4) %>%\n  addPolygons(fillColor = ~pal(shape$Freq), \n              fillOpacity = 0.8, \n              color = \"#000000\", \n              weight = 1, popup = i_popup)\n\n",
    "created" : 1481596028741.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2899535931",
    "id" : "9AA5C1C5",
    "lastKnownWriteTime" : 1481585731,
    "last_content_update" : 1481585731,
    "path" : "~/Desktop/Projects/twitter/script.r",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}